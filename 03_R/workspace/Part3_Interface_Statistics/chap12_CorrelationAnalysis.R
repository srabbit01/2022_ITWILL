# chap11_CorrelationAnalysis

##################################################
# chap11. ìƒê´€ê´€ê³„ ë¶„ì„(Correlation_Analysis)
##################################################
# - ì „ì œ ì¡°ê±´: ìˆ«ìí˜• ë³€ìˆ˜ ëŒ€ìƒ
# - ë‘ ë³€ìˆ˜ì— ëŒ€í•œ ìƒê´€ì„±ì˜ ë°©í–¥ê³¼ í¬ê¸° ì œê³µ
# - ì‚¬ìš©ë³€ìˆ˜: ìˆ«ìí˜• ë³€ìˆ˜ (ë“±ê°„ì²™ë„/ë¹„ìœ¨ì²™ë„)
# - ê´€ë ¨í•¨ìˆ˜: cor(ìƒê´€ê³„ìˆ˜), cov(ê³µë¶„ì‚°), cov2cor(ê³µë¶„ì‚°->ìƒê´€ê³„ìˆ˜)

getwd()
setwd('E:/03. R/data')
product <- read.csv("product.csv") # ìƒí’ˆ ë§Œì¡±ë„
head(product) # ì¹œë°€ë„ ì ì ˆì„± ë§Œì¡±ë„(ë“±ê°„ì²™ë„ - 5ì  ì²™ë„)

# ê¸°ìˆ í†µê³„ëŸ‰
summary(product) # ìš”ì•½í†µê³„ëŸ‰

sd(product$ì œí’ˆ_ì¹œë°€ë„); sd(product$ì œí’ˆ_ì ì ˆì„±); sd(product$ì œí’ˆ_ë§Œì¡±ë„)
# ë³€ìˆ˜ ê°„ì˜ ìƒê´€ê´€ê³„ ë¶„ì„ 
# í˜•ì‹) cor(x,y, method) # xë³€ìˆ˜, yë³€ìˆ˜, method(pearson): ë°©ë²•

# 1) ìƒê´€ê³„ìˆ˜(coefficient of correlation) : ë‘ ë³€ëŸ‰ X,Y ì‚¬ì´ì˜ ìƒê´€ê´€ê³„ ì •ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ìˆ˜ì¹˜(ê³„ìˆ˜)
cor(product$ì œí’ˆ_ì¹œë°€ë„, product$ì œí’ˆ_ì ì ˆì„±) # 0.4992086 -> ë‹¤ì†Œ ë†’ì€ ì–‘ì˜ ìƒê´€ê´€ê³„

cor(product$ì œí’ˆ_ì¹œë°€ë„, product$ì œí’ˆ_ë§Œì¡±ë„) # 0.467145 -> ë‹¤ì†Œ ë†’ì€ ì–‘ì˜ ìƒê´€ê´€ê³„

# ì‹œê°í™”

# ì „ì²´ ë³€ìˆ˜ ê°„ ìƒê´€ê³„ìˆ˜ ë³´ê¸°
cor(product, method="pearson") # í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜ - default

# ë°©í–¥ì„± ìˆëŠ” ìƒ‰ìƒìœ¼ë¡œ í‘œí˜„ - ë™ì¼ ìƒ‰ìƒìœ¼ë¡œ ê·¸ë£¹í™” í‘œì‹œ ë° ìƒ‰ì˜ ë†ë„ 
install.packages("corrgram")   
library(corrgram)
corrgram(product) # ìƒ‰ìƒ ì ìš© - ë™ì¼ ìƒ‰ìƒìœ¼ë¡œ ê·¸ë£¹í™” í‘œì‹œ
corrgram(product, upper.panel=panel.conf) # ìˆ˜ì¹˜(ìƒê´€ê³„ìˆ˜) ì¶”ê°€(ìœ„ìª½)
corrgram(product, lower.panel=panel.conf) # ìˆ˜ì¹˜(ìƒê´€ê³„ìˆ˜) ì¶”ê°€(ì•„ë˜ìª½)

# ì°¨íŠ¸ì— ê³¡ì„ ê³¼ ë³„í‘œ ì¶”ê°€
install.packages("PerformanceAnalytics") 
library(PerformanceAnalytics) 

# ìƒê´€ì„±,pê°’(*),ì •ê·œë¶„í¬ ì‹œê°í™” - ëª¨ìˆ˜ ê²€ì • ì¡°ê±´ 
chart.Correlation(product, histogram=T) 

# ìƒê´€ê³„ìˆ˜ í–‰ë ¬ ì‹œê°í™” 
install.packages('corrplot')
library(corrplot) # ìƒê´€ê³„ìˆ˜ ì‹œê°í™” 
corrplot( cor(product, method="pearson") )
# íƒ€ì›ì˜ í¬ê¸°: ë‘ë³€ìˆ˜ì˜ ìƒê´€ê³„ìˆ˜ í¬ê¸°
# ìƒ‰ìƒ: ë‘ ë³€ìˆ˜ì˜ ì–‘ìŒ ë°©í–¥ ì •ë„

# ìë™ì°¨ì—°ë¹„ ê´€ë ¨ ìë£Œ
str(mtcars)
Cor=cor(mtcars)

class(Cor)
Cor['mpg',]
corrplot(Cor)

# 2) ê³µë¶„ì‚°(covariance) : ë‘ ë³€ëŸ‰ 
# X,Yì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì–‘
cov(product)
cor(product)
cov2cor(cov(product)) # ê³µë¶„ì‚° í–‰ë ¬ -> ìƒê´€ê³„ìˆ˜ í–‰ë ¬ ë³€í™˜(ê¸°ì¡´ ìƒê´€ê³„ìˆ˜ì™€ ë™ì¼í•¨) 

# 3) ìƒê´€ê³„ìˆ˜ vs ê³µë¶„ì‚°(ppt.12) 
# [1] ê³µë¶„ì‚° : ë‘ í™•ë¥ ë³€ìˆ˜ ê°„ì˜ ë¶„ì‚°(í‰ê· ì—ì„œ í¼ì§ ì •ë„)ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í†µê³„
#  - Cov(X,Y) = sum( (X-ğ’™_bar) * (Y-ğ’š_bar) ) / n
#  - ë¬¸ì œì  : ê°’ì´ í° ë³€ìˆ˜ì— ì˜í–¥ì„ ë°›ëŠ”ë‹¤.(ê°’ í° ë³€ìˆ˜ê°€ ìƒê´€ì„± ë†’ìŒ) : 
summary(product) # ê°’ì´ ë¹„ìŠ·í•œ ìë£ŒëŠ” ê³µë¶„ì‚° ì‚¬ìš© ê°€ëŠ¥

x=product$ì œí’ˆ_ì ì ˆì„±
y=product$ì œí’ˆ_ë§Œì¡±ë„

x_bar=mean(x)
y_bar=mean(y)

cov_xy=mean((x-x_bar)*(y-y_bar)) # ëª¨ì§‘ë‹¨ì— ëŒ€í•œ ê³µë¶„ì‚°
cov_xy=sum((x-x_bar)*(y-y_bar))/(length(x)-1) # í‘œë³¸ì§‘ë‹¨ì— ëŒ€í•œ ê³µë¶„ì‚°


cov_xy # 0.5442637
cov(x,y) # 0.5463331 -> í‘œë³¸ì§‘ë‹¨ì— ëŒ€í•œ ê³µë¶„ì‚°

sum((x-x_bar)*(x-x_bar))/(length(x)-1) # 0.7390108 -> ê°™ì€ ì¹¼ëŸ¼ì˜ ê³µë¶„ì‚°ì„ êµ¬í•˜ë”ë¼ë„ 1ì´ ì¶œë ¥ X

# [2] ìƒê´€ê³„ìˆ˜ : ê³µë¶„ì‚°ì„ ê°ê°ì˜ í‘œì¤€í¸ì°¨ë¡œ ë‚˜ëˆˆì–´ ì •ê·œí™”í•œ í†µê³„
#   - ê³µë¶„ì‚° ë¬¸ì œì  í•´ê²° 
#   - ë¶€í˜¸ëŠ” ê³µë¶„ì‚°ê³¼ ë™ì¼, ê°’ì€ ì ˆëŒ€ê°’ 1ì„ ë„˜ì§€ ì•ŠìŒ(-1 ~ 1)    
#   - Corr(X, Y) = Cov(X,Y) / std(X) * std(Y)
corr_xy=cov_xy/(sd(x)*sd(y))
corr_xy # 0.7668527
cor(x,y) # 0.7668527

# [3] ê° ë³€ìˆ˜ ê°„ scale(ë²”ìœ„)ì´ ë‹¤ë¥¸ ê²½ìš°
getwd()
score_iq=read.csv('score_iq.csv')
score_iq
str(score_iq)
# id: ì‹ë³„ë³€ìˆ˜(êµ¬ë¶„ìì´ì§€, ë…ë¦½/ì¢…ì†ë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ì§€ X)
summary(score_iq)

# score, iq, academy(í•™êµ) ê°„ì˜ ìƒê´€ê´€ê³„ -> ì •ê·œí™”(ê°’ì„ ì¼ì •í•˜ê²Œ ë§ì¶¤): ê°ê´€ì  ìƒê´€ì„± í™•ì¸ ê°€ëŠ¥
cor(score_iq[,2:4]) # ìƒê´€ê³„ìˆ˜
#             score        iq   academy
# score   1.0000000 0.8822203 0.8962647 -> ìƒê´€ì„±ì´ ë§¤ìš° ë†’ìŒ
# iq      0.8822203 1.0000000 0.6717826 -> ìƒê´€ì„±ì´ ë†’ìŒ
# academy 0.8962647 0.6717826 1.0000000

# ë¬¸ì œ: ê³µë¶„ì‚°ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
cov(score_iq[2:4]) # í‘œì¤€í™” -> ê³µë¶„ì‚°
#             score        iq  academy
# score   42.968412 51.337539 7.119911
# iq      51.337539 78.807338 7.227293
# academy  7.119911  7.227293 1.468680
# ê³µë¶„ì‚° ë¬¸ì œì : ê°’ì´ í° ë³€ìˆ˜ê°€ ë” í° ìƒê´€ì„±ì„ ê°€ì§

# ìŠ¤ì¼€ì¼ë§: ë³€ìˆ˜ì˜ ì²™ë„(scale)ì„ ë§ì¶”ëŠ” ê³¼ì •

# 1. í‘œì¤€í™”: z = x(í‰ê· )/sigma(í‘œì¤€í¸ì°¨)
z_score=scale(score_iq) # ë°ì´í„°í”„ë ˆì„ -> í–‰ë ¬(matrix)
summary(z_score) # í‰ê· =0, í‘œì¤€í¸ì°¨=1
cov(z_score) # ê³µë¶„ì‚°ì˜ ê²°ê³¼ì™€ ë™ì¼
class(z_score)

cov(z_score[,2:4])
#             score        iq   academy
# score   1.0000000 0.8822203 0.8962647
# iq      0.8822203 1.0000000 0.6717826
# academy 0.8962647 0.6717826 1.0000000

# 2. ì •ê·œí™”: ìµœì†Ÿê°’/ìµœëŒ“ê°’ ì´ìš©
nor_scale=function(x){
  nor=(x-min(x))/(max(x)-min(x))
  return(nor)
}
nor_re=apply(score_iq[2:4],2,nor_scale)
apply(score_iq[2:4],MARGIN=2,FUN=nor_scale)
summary(nor_re) # min: 0, max: 1
class(nor_re)

cov(nor_re)
#              score         iq    academy
# score   0.06874946 0.05867147 0.07119911
# iq      0.05867147 0.06433252 0.05162352
# academy 0.07119911 0.05162352 0.09179251

# 4) ìŠ¤í”¼ì–´ë§Œ(Spearman) ìƒê´€ê³„ìˆ˜
# - ì„œì—´ì²™ë„ ë³€ìˆ˜ë¥¼ ëŒ€ìƒìœ¼ë¡œ ë‹¨ì¡° ì¦ê°€ ë˜ëŠ” í•˜ê°•í•˜ëŠ” ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê³„ìˆ˜ 
# - ì„ í˜•ì„±ì€ ì•„ë‹ˆì§€ë©´ ì¤„ê³§ ì¦ê°€í•˜ê±°ë‚˜ í•˜ê°•í•˜ëŠ” ê´€ê³„ ì´ìš© 

# ì˜ˆ) êµ­ì–´ì„±ì  ì„ì°¨ì™€ ì˜ì–´ì„±ì  ì„ì°¨ì˜ ê´€ê³„
# cor(êµ­ì–´ì„±ì _ì„ì°¨, ì˜ì–´ì„±ì _ì„ì°¨, method = "spearman") 

# ì ìˆ˜
kor_score=round(runif(10,min=50,max=90))
eng_score=round(runif(10,min=40,max=75))

kor_score
eng_score

# ì„œì—´ì²™ë„: ìˆœì„œ í¬í•¨
kor_score_rank=sort(kor_score)
eng_score_rank=sort(eng_score)

kor_score_rank
eng_score_rank

# ìŠ¤í”¼ì–´ë§Œ í•¨ìˆ˜ 
cor(kor_score_rank,eng_score_rank,method="spearman") # 0.9939209: ì•„ì£¼ ê°•í•œ ë‹¨ì¡°ì¦ê°€ í˜•íƒœ
cor(kor_score_rank,eng_score_rank) # í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜ -> 0.9620942: ì•„ì£¼ ê°•í•œ í˜•íƒœ X

# ì‹œê°í™”
plot(kor_score_rank,eng_score_rank,type='l') # ì„ í˜•
plot(kor_score_rank,eng_score_rank) # ì‚°ì ë„
